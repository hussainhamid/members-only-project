<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/styles.css">
  <title>index</title>
</head>

<body>


  <% if (currentUser) { %>
  <h1>you have logged in as: <%= currentUser.username %></h1>

  <button onclick="location.href='/send-message'">send message</button>

  <button onclick="location.href='/log-out'">Log Out</button>


  <div class="messages-div">
    <% user.forEach(row => { %>
    <div class="message">

      <div class="name">
        <h4><%= row.username %></h4>
      </div>

      <div class="title">
        <h2><%= row.title  %></h2>
      </div>

      <div class="message">
        <p><%= row.message %></p>
      </div>


      <% if (status == "admin") { %>
      <div class="btns">
        <button class="btn" onclick="confirmDelete(event, <%= row.message_id %>)">Delete</button>
      </div>
      <% } %>


    </div>
    <% }) %>
  </div>


  <table>
    <tr>
      <th>username</th>
      <th>title</th>
      <th>message</th>
      <th>status</th>
      <th>time</th>
    </tr>

    <% user.forEach(row => { %>
    <tr>
      <td><%= row.username %></td>
      <td><%= row.title %></td>
      <td><%= row.message %></td>
      <td><%= row.status %></td>
      <td><%= row.time %></td>
    </tr>
    <% }) %>
  </table>
  <% } else { %>
  <button onclick="location.href='/sign-up'">sign-up</button>
  <button onclick="location.href='/log-in'">Log in</button>
  <% } %>



  <script>
    function confirmDelete(event, id) {
      const confirmBtn = confirm("Are you sure");

      if (!confirmBtn) {
        event.preventDefault();
      } else {
        window.location.href = `/deleteMessage/${id}`;
      }
    }
  </script>

</body>

</html>